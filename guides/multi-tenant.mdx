---
title: 'Multi-tenant Authorization'
description: 'Isolating permissions across tenants with hierarchical scopes'
icon: 'building'
---

## Overview

Multi-tenant applications need strong isolation between tenants while sharing common infrastructure. Bedrock's hierarchical scope model naturally supports multi-tenancy, allowing you to define tenant-specific roles, permissions, and access controls.

## Multi-tenant Architecture

```
Platform (global scope)
├── Tenant A (tenant scope)
│   ├── Team A1
│   └── Team A2
├── Tenant B (tenant scope)
│   ├── Team B1
│   └── Team B2
└── Tenant C (tenant scope)
    └── Team C1
```

## Setting Up Multi-tenancy

### 1. Define Scope Types

```bash
# Create all scope types at once
curl -X POST 'https://api.example.com/scope-types/batch' \
  -H 'Content-Type: application/json' \
  -d '[
    {"id": "type_platform", "name": "Platform", "config": {"permissionMode": "define"}},
    {"id": "type_tenant", "name": "Tenant", "config": {"permissionMode": "inherit"}},
    {"id": "type_team", "name": "Team", "config": {"permissionMode": "inherit"}}
  ]'

# Define hierarchy: Platform → Tenant → Team
curl -X POST 'https://api.example.com/scope-type-hierarchy' \
  -d '{"parentTypeId": "type_platform", "childTypeId": "type_tenant"}'

curl -X POST 'https://api.example.com/scope-type-hierarchy' \
  -d '{"parentTypeId": "type_tenant", "childTypeId": "type_team"}'
```

### 2. Create Platform and Tenants

```bash
# Create platform and all tenant scopes at once
curl -X POST 'https://api.example.com/scopes/batch' \
  -H 'Content-Type: application/json' \
  -d '[
    {"id": "scope_platform", "name": "My SaaS Platform", "typeId": "type_platform"},
    {"id": "scope_acme", "name": "Acme Corp", "typeId": "type_tenant", "externalId": "tenant-acme"},
    {"id": "scope_globex", "name": "Globex Inc", "typeId": "type_tenant", "externalId": "tenant-globex"}
  ]'

# Link tenants to platform
curl -X POST 'https://api.example.com/scope-hierarchy/batch' \
  -H 'Content-Type: application/json' \
  -d '[
    {"parentScopeId": "scope_platform", "childScopeId": "scope_acme"},
    {"parentScopeId": "scope_platform", "childScopeId": "scope_globex"}
  ]'
```

### 3. Define Platform-wide and Tenant-specific Roles

```bash
# Create all roles at once
curl -X POST 'https://api.example.com/roles/batch' \
  -H 'Content-Type: application/json' \
  -d '[
    {"id": "role_platform_admin", "name": "Platform Admin", "description": "Full platform access", "scopeId": "scope_platform"},
    {"id": "role_support_agent", "name": "Support Agent", "description": "Customer support access", "scopeId": "scope_platform"},
    {"id": "role_tenant_admin", "name": "Tenant Admin", "description": "Full tenant access", "scopeId": "scope_platform"},
    {"id": "role_tenant_member", "name": "Tenant Member", "description": "Basic tenant access", "scopeId": "scope_platform"},
    {"id": "role_acme_auditor", "name": "Acme Auditor", "description": "Acme-specific audit role", "scopeId": "scope_acme"}
  ]'
```

## Tenant Isolation

### Users Can Only Access Their Tenant

```bash
# Create Acme user with membership in one request
curl -X POST 'https://api.example.com/subjects' \
  -H 'Content-Type: application/json' \
  -d '{
    "subjectType": "user",
    "externalId": "acme-user-1",
    "displayName": "Acme User",
    "memberships": [
      {"scopeId": "scope_acme", "roleIds": ["role_tenant_member"]}
    ]
  }'

# This user has NO access to Globex tenant
# They can only access scope_acme and its children
```

### Cross-tenant Access (Support Agents)

```bash
# Support agent with platform-level access
curl -X POST 'https://api.example.com/subjects' \
  -H 'Content-Type: application/json' \
  -d '{
    "subjectType": "user",
    "externalId": "support-agent-1",
    "displayName": "Support Agent",
    "memberships": [
      {"scopeId": "scope_platform", "roleIds": ["role_support_agent"]}
    ]
  }'

# Support agent can now access all tenants (based on role permissions)
```

## Agents in Multi-tenant Environments

### Tenant-specific Agents

Each tenant can have their own AI agents:

```bash
# Acme's coding assistant - scoped to Acme only
curl -X POST 'https://api.example.com/subjects' \
  -H 'Content-Type: application/json' \
  -d '{
    "subjectType": "agent",
    "externalId": "acme-coding-assistant",
    "displayName": "Acme Coding Assistant",
    "meta": {"tenant": "acme", "purpose": "code-review"},
    "memberships": [
      {"scopeId": "scope_acme", "roleIds": ["role_tenant_member"]}
    ]
  }'

# This agent can ONLY access Acme's scope
```

### Platform-wide Agents

Some agents may need cross-tenant access:

```bash
# Platform analytics agent with read-only access
curl -X POST 'https://api.example.com/subjects' \
  -H 'Content-Type: application/json' \
  -d '{
    "subjectType": "agent",
    "externalId": "platform-analytics-agent",
    "displayName": "Platform Analytics Agent",
    "meta": {"purpose": "cross-tenant-analytics"},
    "memberships": [
      {"scopeId": "scope_platform", "roleIds": ["role_analytics_reader"]}
    ]
  }'
```

### Restricting Platform Agents in Specific Tenants

Some tenants may want to opt out of platform-wide agents:

```bash
# Globex doesn't want platform agents accessing their data
curl -X POST 'https://api.example.com/scope-overrides/roles' \
  -d '{
    "childScopeId": "scope_globex",
    "roleId": "role_analytics_reader",
    "state": "disabled"
  }'
```

## Permission Patterns

### Tenant-isolated Permissions

```bash
# Create permissions at platform level (inherited by all tenants)
curl -X POST 'https://api.example.com/permissions/batch' \
  -H 'Content-Type: application/json' \
  -d '[
    {"id": "perm_read_data", "scopeId": "scope_platform", "action": "read", "resourceType": "data", "resourcePattern": "*", "key": "data:read:*"},
    {"id": "perm_write_data", "scopeId": "scope_platform", "action": "write", "resourceType": "data", "resourcePattern": "*", "key": "data:write:*"},
    {"id": "perm_delete_data", "scopeId": "scope_platform", "action": "delete", "resourceType": "data", "resourcePattern": "*", "key": "data:delete:*"},
    {"id": "perm_admin_tenant", "scopeId": "scope_platform", "action": "admin", "resourceType": "tenant", "resourcePattern": "*", "key": "tenant:admin:*"}
  ]'
```

### Tenant-specific Permission Overrides

```bash
# Acme wants to disable data deletion
curl -X POST 'https://api.example.com/scope-overrides/permissions' \
  -d '{
    "childScopeId": "scope_acme",
    "permissionId": "perm_delete_data",
    "state": "disabled"
  }'
```

## Querying Tenant Access

When a request comes in, determine which tenant the user/agent belongs to:

```typescript
async function getTenantAccess(subjectId: string, tenantId: string) {
  // Get memberships for this subject in the tenant scope
  const memberships = await fetch(
    `/memberships?subjectId=${subjectId}&scopeId=${tenantId}`
  );
  
  if (memberships.length === 0) {
    // Check if they have platform-level access
    const platformMemberships = await fetch(
      `/memberships?subjectId=${subjectId}&scopeId=scope_platform`
    );
    
    if (platformMemberships.length === 0) {
      return { hasAccess: false };
    }
    
    // They have platform access - check if it applies to this tenant
    return { hasAccess: true, level: 'platform' };
  }
  
  return { hasAccess: true, level: 'tenant' };
}
```

## Best Practices

<AccordionGroup>
  <Accordion title="Use external IDs for tenant mapping">
    Store your application's tenant ID as the scope's `externalId` for easy lookup.
  </Accordion>
  <Accordion title="Define common roles at platform level">
    Roles like "Tenant Admin" and "Tenant Member" should be defined at the platform level so all tenants inherit them.
  </Accordion>
  <Accordion title="Allow tenant-specific customization">
    Let tenants create their own roles and permissions within their scope.
  </Accordion>
  <Accordion title="Audit cross-tenant access">
    Log all access by platform-level users/agents to tenant data.
  </Accordion>
  <Accordion title="Respect tenant opt-outs">
    Use scope overrides to respect tenant preferences about platform-wide features.
  </Accordion>
</AccordionGroup>

## Next Steps

<CardGroup cols={2}>
  <Card title="Scope Overrides" icon="sliders" href="/guides/scope-overrides">
    Fine-tune permissions at tenant level
  </Card>
  <Card title="Agent Governance" icon="robot" href="/guides/agent-governance">
    Manage agents across tenants
  </Card>
</CardGroup>
